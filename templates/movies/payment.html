{% extends "users/basic.html" %}

{% block content %}
<div class="container py-5">
    <h1 class="text-center md-4">Pay for {{ movie.name }}</h1>
    <p class="text-center">Amount: Rs.{{ price|floatformat:2 }}</p>
    <div class="text-center">
        <form id="payment-form">
            {% csrf_token %}
            <input type="hidden" name="movie_name" value="{{ movie.name }}">
            <input type="hidden" name="price" value="{{ price }}">
            <button class="btn btn-primary btn-lg" id="checkout-button">
                Pay Now
            </button>
        </form>
    </div>
</div>
<script src="https://js.stripe.com/v3/"></script>
<script>
    var stripe = Stripe('{{ stripe_public_key }}');
    var checkoutButton = document.getElementById('checkout-button');
    checkoutButton.addEventListener('click', function(e){
        e.preventDefault();
        fetch("{% url 'create_checkout_session' %}", {
            method: "POST",
            headers: {'X-CSRFToken': '{{ csrf_token }}'},
            body: new URLSearchParams(new FormData(document.getElementById('payment-form')))
        })
        .then(response => response.json())
        .then(data => stripe.redirectToCheckout({ sessionId: data.id }));
    });
</script>
{% endblock %}

